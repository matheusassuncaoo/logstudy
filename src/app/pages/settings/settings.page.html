<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button (click)="goBack()" defaultHref="/tabs/perfil"></ion-back-button>
    </ion-buttons>
    <ion-title>Configurações</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="settings-container">
    <!-- Profile Section -->
    <div class="settings-section">
      <h2>Perfil</h2>
      <ion-list>
        <ion-item>
          <ion-avatar slot="start">
            <img [src]="user?.avatar" *ngIf="user?.avatar" />
            <ion-icon name="person-circle" *ngIf="!user?.avatar"></ion-icon>
          </ion-avatar>
          <ion-label>
            <h3>{{ user?.name || 'Usuário' }}</h3>
            <p>{{ user?.email || 'email@exemplo.com' }}</p>
          </ion-label>
        </ion-item>

        <ion-item button (click)="editProfile()">
          <ion-icon name="person-outline" slot="start"></ion-icon>
          <ion-label>Editar Perfil</ion-label>
          <ion-icon name="chevron-forward" slot="end"></ion-icon>
        </ion-item>

        <ion-item button (click)="changePassword()">
          <ion-icon name="key-outline" slot="start"></ion-icon>
          <ion-label>Alterar Senha</ion-label>
          <ion-icon name="chevron-forward" slot="end"></ion-icon>
        </ion-item>
      </ion-list>
    </div>

    <!-- Notifications Section -->
    <div class="settings-section">
      <h2>Notificações</h2>
      <ion-list>
        <ion-item>
          <ion-icon name="timer-outline" slot="start"></ion-icon>
          <ion-label>Fim do Pomodoro</ion-label>
          <ion-toggle [(ngModel)]="notifications.pomodoroEnd" color="primary"></ion-toggle>
        </ion-item>

        <ion-item>
          <ion-icon name="cafe-outline" slot="start"></ion-icon>
          <ion-label>Fim da Pausa</ion-label>
          <ion-toggle [(ngModel)]="notifications.breakEnd" color="primary"></ion-toggle>
        </ion-item>

        <ion-item>
          <ion-icon name="alarm-outline" slot="start"></ion-icon>
          <ion-label>Lembrete Diário</ion-label>
          <ion-toggle [(ngModel)]="notifications.dailyReminder" color="primary"></ion-toggle>
        </ion-item>

        <ion-item>
          <ion-icon name="bar-chart-outline" slot="start"></ion-icon>
          <ion-label>Relatório Semanal</ion-label>
          <ion-toggle [(ngModel)]="notifications.weeklyReport" color="primary"></ion-toggle>
        </ion-item>
      </ion-list>
    </div>

    <!-- Timer Preferences Section -->
    <div class="settings-section">
      <h2>Preferências do Timer</h2>
      <ion-list>
        <ion-item>
          <ion-label position="stacked">
            <div class="label-with-value">
              <span>Tempo de Foco Padrão</span>
              <ion-text color="primary" class="value-badge">{{ preferences.defaultPomodoroLength }} min</ion-text>
            </div>
          </ion-label>
          <ion-range 
            [(ngModel)]="preferences.defaultPomodoroLength"
            min="5" 
            max="90" 
            step="5"
            pin="true"
            ticks="true"
            snaps="true"
            color="primary"
            (ionChange)="onPomodoroLengthChanged()">
            <ion-label slot="start">5</ion-label>
            <ion-label slot="end">90</ion-label>
          </ion-range>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">
            <div class="label-with-value">
              <span>Pausa Curta Padrão</span>
              <ion-text color="secondary" class="value-badge">{{ preferences.defaultShortBreak }} min</ion-text>
            </div>
          </ion-label>
          <ion-range 
            [(ngModel)]="preferences.defaultShortBreak"
            min="1" 
            max="15" 
            step="1"
            pin="true"
            ticks="true"
            snaps="true"
            color="secondary">
            <ion-label slot="start">1</ion-label>
            <ion-label slot="end">15</ion-label>
          </ion-range>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">
            <div class="label-with-value">
              <span>Pausa Longa Padrão</span>
              <ion-text color="tertiary" class="value-badge">{{ preferences.defaultLongBreak }} min</ion-text>
            </div>
          </ion-label>
          <ion-range 
            [(ngModel)]="preferences.defaultLongBreak"
            min="10" 
            max="45" 
            step="5"
            pin="true"
            ticks="true"
            snaps="true"
            color="tertiary">
            <ion-label slot="start">10</ion-label>
            <ion-label slot="end">45</ion-label>
          </ion-range>
        </ion-item>

        <ion-item>
          <ion-icon name="volume-medium-outline" slot="start"></ion-icon>
          <ion-label>Som</ion-label>
          <ion-toggle [(ngModel)]="preferences.soundEnabled" color="primary"></ion-toggle>
        </ion-item>

        <ion-item>
          <ion-icon name="phone-portrait-outline" slot="start"></ion-icon>
          <ion-label>Vibração</ion-label>
          <ion-toggle [(ngModel)]="preferences.vibrationEnabled" color="primary"></ion-toggle>
        </ion-item>
      </ion-list>
    </div>

    <!-- About Section -->
    <div class="settings-section">
      <h2>Sobre</h2>
      <ion-list>
        <ion-item button (click)="navigateToAbout()">
          <ion-icon name="information-circle-outline" slot="start"></ion-icon>
          <ion-label>Sobre o App</ion-label>
          <ion-icon name="chevron-forward" slot="end"></ion-icon>
        </ion-item>

        <ion-item button (click)="navigateToTerms()">
          <ion-icon name="document-text-outline" slot="start"></ion-icon>
          <ion-label>Termos de Uso</ion-label>
          <ion-icon name="chevron-forward" slot="end"></ion-icon>
        </ion-item>

        <ion-item button (click)="navigateToPrivacy()">
          <ion-icon name="shield-checkmark-outline" slot="start"></ion-icon>
          <ion-label>Política de Privacidade</ion-label>
          <ion-icon name="chevron-forward" slot="end"></ion-icon>
        </ion-item>

        <ion-item>
          <ion-icon name="code-slash-outline" slot="start"></ion-icon>
          <ion-label>
            <h3>Versão</h3>
            <p>1.0.0</p>
          </ion-label>
        </ion-item>
      </ion-list>
    </div>

    <!-- Save Button -->
    <div class="save-section">
      <ion-button expand="block" size="large" (click)="saveSettings()">
        <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
        Salvar Configurações
      </ion-button>
    </div>

    <!-- Logout Button -->
    <div class="logout-section">
      <ion-button expand="block" fill="outline" color="danger" (click)="logout()">
        <ion-icon name="log-out-outline" slot="start"></ion-icon>
        Sair
      </ion-button>
    </div>
  </div>
</ion-content>
